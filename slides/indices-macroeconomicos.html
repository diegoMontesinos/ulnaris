<!-- INDICES MACROECONOMICOS -->
<section id="indices-macroeconomicos" class="ulnaris-legals-blue" data-autoslide="0" data-state="indices-macroeconomicos-state">
	<div class="step-container">

		<!-- TITULO -->
		<div class="ulnaris-title">
			<span>Índices Macroeconómicos</span>
		</div>

		<!-- CONTENIDO -->
		<div class="ulnaris-content">

			<!-- Grafica GDP -->
			<div id="indices-macroeconomicos-gdp" style="left: 0px; top: 0px;">
				<div><span>%GDP</span></div>
			</div>

			<!-- Grafica Inflation -->
			<div id="indices-macroeconomicos-inflation" style="left: 810px; top: 0px;">
				<div><span>Inflation</span></div>
			</div>

			<!-- Grafica Inflation -->
			<div id="indices-macroeconomicos-government" style="left: 0px; top: 300px;">
				<div><span>Government Expense<br>Annual growth rate</span></div>
			</div>

			<!-- Exchange Rate -->
			<div id="indices-macroeconomicos-exchange" style="left: 810px; top: 300px;">
				<div><span>Exchange Rate</span></div>
			</div>
		</div>
	</div>
</div>

<style type="text/css">
	#indices-macroeconomicos-gdp > div,
	#indices-macroeconomicos-inflation > div,
	#indices-macroeconomicos-government > div,
	#indices-macroeconomicos-exchange > div{
		position: absolute;
		font-size: 20px;
		top: 4px;
		left: 200px;
		text-align: center;
	}

	#indices-macroeconomicos .ulnaris-content > div {
		position: absolute;
	}

	#indices-macroeconomicos .axis path,
	#indices-macroeconomicos .axis line {
		stroke: #FFF;
		fill: none;
		stroke-width: 3px;
	}

	#indices-macroeconomicos .axis text {
		stroke: none;
		fill: #FFF;
		font-size: 16px;
	}
</style>

<script type="text/javascript">
	(function () {
		
		// Cargamos los datos
		d3.json("data/indicesmacro.json", function (error, root) {

			// GRAFICA GDP
			var gdp = ulnaris.D3.buildLineChart({
				container   : "#indices-macroeconomicos-gdp",
				width       : 662,
				height      : 270,
				margin      : { top: 20, right: 40, bottom: 30, left: 40 },
				rangeWidth  : 0.4,
				lines       : {
					data: [
						mergeData(root.gdp.line1),
						mergeData(root.gdp.line2)
					],
					style: [
						{ "stroke": "#ff2600", "fill": "none", "stroke-width": "4px" },
						{ "stroke": "#0085cc", "fill": "none", "stroke-width": "4px" }
					],
					points: [
						{ "fill" : "#ff2600", "stroke": "none", "font-size": "14px" },
						{ "fill" : "#0085cc", "stroke": "none", "font-size": "14px"}
					]
				},
				format : function (val) { return val + "%"; }
			});

			// Grafica Inflation
			var inflation = ulnaris.D3.buildLineChart({
				container   : "#indices-macroeconomicos-inflation",
				width       : 662,
				height      : 270,
				margin      : { top: 20, right: 40, bottom: 30, left: 40 },
				rangeWidth  : 0.4,
				lines       : {
					data: [
						mergeData(root.inflation.line1),
						mergeData(root.inflation.line2)
					],
					style: [
						{ "stroke": "#ff2600", "fill": "none", "stroke-width": "4px" },
						{ "stroke": "#0085cc", "fill": "none", "stroke-width": "4px" }
					],
					points: [
						{ "fill" : "#ff2600", "stroke": "none", "font-size": "14px" },
						{ "fill" : "#0085cc", "stroke": "none", "font-size": "14px"}
					]
				},
				format : function (val) { return val + "%"; }
			});

			// Government
			var government = ulnaris.D3.buildLineChart({
				container   : "#indices-macroeconomicos-government",
				width       : 662,
				height      : 270,
				margin      : { top: 20, right: 40, bottom: 30, left: 40 },
				rangeWidth  : 0.4,
				lines       : {
					data: [
						mergeData(root.government.line1),
						mergeData(root.government.line2),
						mergeData(root.government.line3)
					],
					style: [
						{ "stroke": "#3989c7", "fill": "none", "stroke-width": "4px" },
						{ "stroke": "#ffe087", "fill": "none", "stroke-width": "4px" },
						{ "stroke": "#d8b34b", "fill": "none", "stroke-width": "4px" }
					],
					points: [
						{ "fill" : "#3989c7", "stroke": "none", "font-size": "14px" },
						{ "fill" : "#ffe087", "stroke": "none", "font-size": "14px" },
						{ "fill" : "#d8b34b", "stroke": "none", "font-size": "14px" }
					]
				},
				format : function (val) { return val + "%"; }
			});

			// Exchange Rate
			var exchange = ulnaris.D3.buildLineChart({
				container   : "#indices-macroeconomicos-exchange",
				width       : 662,
				height      : 270,
				margin      : { top: 20, right: 40, bottom: 30, left: 40 },
				rangeWidth  : 0.4,
				lines       : {
					data: [
						mergeData(root.exchange.line1),
						mergeData(root.exchange.line2)
					],
					style: [
						{ "stroke": "#ff2600", "fill": "none", "stroke-width": "4px" },
						{ "stroke": "#0085cc", "fill": "none", "stroke-width": "4px" }
					],
					points: [
						{ "fill" : "#ff2600", "stroke": "none", "font-size": "14px" },
						{ "fill" : "#0085cc", "stroke": "none", "font-size": "14px"}
					]
				},
				format : function (val) { return val + ""; }
			});

			function resetChart (chart) {
				var resetFunc = d3.svg.line()
				.x(function (d) { return chart.x(d.label); })
				.y(function (d) { return 220; });

				chart.svg.selectAll(".line-chart")
				.attr("d", resetFunc);

				chart.svg.selectAll(".label-value")
				.attr("y", function (d) { return 240; });
			}

			function animateChart (chart, delay, duration) {
				var lineFunc = d3.svg.line()
				.x(function (d) { return chart.x(d.label); })
				.y(function (d) { return chart.y(d.value); });

				chart.svg.selectAll(".line-chart")
				.transition()
				.delay(delay)
				.duration(duration)
				.attr("d", lineFunc);

				chart.svg.selectAll(".label-value")
				.transition()
				.delay(delay)
				.duration(duration)
				.attr("y", function (d) { return chart.y(d.value) + 20; })
			}

			Reveal.addEventListener("indices-macroeconomicos-state", function() {
				var graphs = [gdp, inflation, government, exchange];

				for (var i = 0; i < graphs.length; i++) {
					resetChart(graphs[i]);
					animateChart(graphs[i], 800, 1900);
				}
			});
		});
		function mergeData (data) {
			var data_ = [];

			for (var i = 0; i < data.labels.length; i++) {
				data_.push({
					label: data.labels[i],
					value: data.values[i]
				});
			}

			return data_;
		}
	})();
</script>